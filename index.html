<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è–èª•å‹•ç‰©èŠ±è—äº¤æ›æ´¾å°</title>
    <style>
        /* --- åŸºç¤è¨­å®š --- */
        body { font-family: 'Helvetica', 'Arial', sans-serif; background-color: #fdf5e6; color: #333; margin: 0; padding: 20px; text-align: center; }
        h1, h2 { color: #2c5e2e; } /* è–èª•ç¶  */
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .hidden { display: none; }
        .btn { background-color: #c0392b; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; font-size: 16px; margin-top: 20px; }
        .btn:disabled { background-color: #ccc; cursor: not-allowed; }
        .btn:hover:not(:disabled) { background-color: #a93226; }

        /* --- æ­¥é©Ÿ 1: è§’è‰²é¸æ“‡ --- */
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px; }
        .card { border: 2px solid #ddd; border-radius: 10px; padding: 10px; cursor: pointer; transition: 0.3s; position: relative; }
        .card.selected { border-color: #c0392b; background-color: #fadbd8; }
        .card.disabled { opacity: 0.5; cursor: not-allowed; background-color: #eee; }
        .card img { width: 100%; height: 80px; object-fit: contain; }
        
        /* --- æ­¥é©Ÿ 3: èŠ±è—å¯¦é©—å®¤ (äº’å‹•è¦–çª—) --- */
        .canvas-container { position: relative; width: 100%; height: 350px; background-color: #fffaf0; border: 2px dashed #2c5e2e; margin-bottom: 10px; overflow: hidden; }
        .flower-assets { display: flex; gap: 10px; overflow-x: auto; padding: 10px 0; border-top: 1px solid #eee; }
        .asset-item { width: 60px; height: 60px; border: 1px solid #ddd; border-radius: 5px; cursor: pointer; flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .draggable-item { position: absolute; cursor: move; font-size: 40px; user-select: none; }
        
        /* --- è¡¨å–® --- */
        .form-group { text-align: left; margin-bottom: 15px; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ„ è–èª•èŠ±è—äº¤æ› ğŸŒ¸</h1>
    <div id="progress-text">æ­¥é©Ÿ 1 / 5</div>

    <div id="step-1" class="step">
        <h2>æˆ‘æ˜¯èª°ï¼Ÿ</h2>
        <p>è«‹é¸æ“‡ä»£è¡¨ä½ çš„å‹•ç‰©è§’è‰²ï¼ˆç°åº•ä»£è¡¨å·²è¢«é¸èµ°ï¼‰</p>
        <div class="grid" id="avatar-grid">
            </div>
        <button class="btn" id="btn-step-1" disabled>ä¸‹ä¸€æ­¥</button>
    </div>

    <div id="step-2" class="step hidden">
        <h2>äº¤æ›å¿ƒé¡˜</h2>
        <p>ä½ å¸Œæœ›æ”¶åˆ°èª°é…çš„èŠ±ï¼Ÿ</p>
        <select id="receive-select" style="padding:10px; width:100%; margin-bottom:20px;">
            <option value="">è«‹é¸æ“‡...</option>
            </select>

        <p>ä½ æƒ³æŠŠä½ çš„èŠ±é€çµ¦èª°ï¼Ÿ</p>
        <select id="give-select" style="padding:10px; width:100%;">
            <option value="">è«‹é¸æ“‡...</option>
            </select>
        <button class="btn" id="btn-step-2">ä¸‹ä¸€æ­¥</button>
    </div>

    <div id="step-3" class="step hidden">
        <h2>ğŸ¨ èŠ±è—å¯¦é©—å®¤</h2>
        <p>é»æ“Šä¸‹æ–¹èŠ±æåŠ å…¥ç•«å¸ƒï¼Œæ‹–æ›³èª¿æ•´ä½ç½®</p>
        
        <div class="canvas-container" id="flower-canvas">
            <span style="position:absolute; top:40%; left:35%; color:#ccc; pointer-events:none;">åœ¨é€™è£¡å‰µä½œ</span>
        </div>

        <div class="flower-assets">
            <div class="asset-item" onclick="addFlower('ğŸŒ¹')">ğŸŒ¹</div>
            <div class="asset-item" onclick="addFlower('ğŸŒ»')">ğŸŒ»</div>
            <div class="asset-item" onclick="addFlower('ğŸŒ·')">ğŸŒ·</div>
            <div class="asset-item" onclick="addFlower('ğŸŒ¿')">ğŸŒ¿</div>
            <div class="asset-item" onclick="addFlower('ğŸŒ¾')">ğŸŒ¾</div>
            <div class="asset-item" onclick="addFlower('ğŸ€')">ğŸ€</div>
            <div class="asset-item" onclick="addFlower('â„ï¸')">â„ï¸</div>
        </div>
        
        <button class="btn" style="background-color: #7f8c8d;" onclick="clearCanvas()">æ¸…ç©ºé‡ä¾†</button>
        <button class="btn" id="btn-step-3">å®Œæˆè¨­è¨ˆ</button>
    </div>

    <div id="step-4" class="step hidden">
        <h2>âœï¸ è–èª•ç¥ç¦ & è³‡æ–™</h2>
        <div class="form-group">
            <label>çµ¦å°æ–¹çš„è–èª•ç¥ç¦ï¼š</label>
            <textarea rows="4" placeholder="å¯«ä¸‹æš–å¿ƒçš„è©±..."></textarea>
        </div>
        <hr>
        <div class="form-group">
            <label>åŒ¯æ¬¾å¸³è™Ÿæœ«äº”ç¢¼ï¼š</label>
            <input type="text" placeholder="12345">
        </div>
        <div class="form-group">
            <label>é ˜èŠ±æš±ç¨±ï¼š</label>
            <input type="text" placeholder="çœŸå¯¦å§“åæˆ–æš±ç¨±">
        </div>
        <button class="btn" id="btn-submit">ç¢ºèªé€å‡º</button>
    </div>

    <div id="step-5" class="step hidden">
        <h2>ğŸ‰ å ±åæˆåŠŸï¼</h2>
        <p>æ„Ÿè¬ä½ çš„åƒèˆ‡ï¼Œè«‹è¨˜å¾—æº–æ™‚åŒ¯æ¬¾ã€‚</p>
        <p>æˆ‘å€‘å°‡æœƒæŠŠä½ çš„å¿ƒæ„å‚³é”çµ¦å°æ–¹ï¼</p>
    </div>
</div>

<script>
    // --- è³‡æ–™è¨­å®š ---
    const animals = [
        { id: 'rabbit', name: 'æº«æŸ”å…”å­', icon: 'ğŸ°', taken: true }, // æ¨¡æ“¬å·²è¢«é¸èµ°
        { id: 'zebra', name: 'é…·é…·æ–‘é¦¬', icon: 'ğŸ¦“', taken: false },
        { id: 'frog', name: 'å¿«æ¨‚é’è›™', icon: 'ğŸ¸', taken: false },
        { id: 'lion', name: 'éœ¸æ°£ç…å­', icon: 'ğŸ¦', taken: false },
        { id: 'cat', name: 'å„ªé›…è²“å’ª', icon: 'ğŸ±', taken: false },
        { id: 'bear', name: 'æ†¨åšç†Šç†Š', icon: 'ğŸ»', taken: false }
    ];

    let userSelection = {
        myRole: null,
        receiveFrom: null,
        giveTo: null,
        design: [] 
    };

    // --- åˆå§‹åŒ– ---
    const avatarGrid = document.getElementById('avatar-grid');
    const receiveSelect = document.getElementById('receive-select');
    const giveSelect = document.getElementById('give-select');

    // æ¸²æŸ“è§’è‰²é¸é …
    animals.forEach(animal => {
        // 1. Grid å¡ç‰‡
        const div = document.createElement('div');
        div.className = `card ${animal.taken ? 'disabled' : ''}`;
        div.innerHTML = `<div style="font-size:40px">${animal.icon}</div><div>${animal.name}</div>`;
        
        if (!animal.taken) {
            div.onclick = () => selectRole(div, animal.id);
        }
        avatarGrid.appendChild(div);

        // 2. ä¸‹æ‹‰é¸å–® (å…ˆå…¨éƒ¨æ”¾å…¥ï¼Œä¸‹ä¸€æ­¥å†éæ¿¾è‡ªå·±)
        const option = `<option value="${animal.id}">${animal.icon} ${animal.name}</option>`;
        receiveSelect.innerHTML += option;
        giveSelect.innerHTML += option;
    });

    // --- é‚è¼¯æ§åˆ¶ ---
    
    // é¸æ“‡è§’è‰²
    function selectRole(element, id) {
        document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
        element.classList.add('selected');
        userSelection.myRole = id;
        document.getElementById('btn-step-1').disabled = false;
    }

    // é é¢åˆ‡æ›
    function goToStep(stepNum) {
        document.querySelectorAll('.step').forEach(s => s.classList.add('hidden'));
        document.getElementById(`step-${stepNum}`).classList.remove('hidden');
        document.getElementById('progress-text').innerText = `æ­¥é©Ÿ ${stepNum} / 5`;
    }

    // æŒ‰éˆ•ç›£è½
    document.getElementById('btn-step-1').onclick = () => {
        // ç°¡å–®éæ¿¾ï¼šä¸èƒ½é€çµ¦è‡ªå·±ï¼Œä¹Ÿä¸èƒ½æ”¶è‡ªå·±çš„ (å¯é¸)
        // é€™è£¡åƒ…ç¤ºç¯„é€²å…¥ä¸‹ä¸€æ­¥
        goToStep(2);
    };

    document.getElementById('btn-step-2').onclick = () => {
        const r = receiveSelect.value;
        const g = giveSelect.value;
        if(!r || !g) { alert('è«‹é¸æ“‡å°è±¡å–”ï¼'); return; }
        userSelection.receiveFrom = r;
        userSelection.giveTo = g;
        goToStep(3);
    };

    document.getElementById('btn-step-3').onclick = () => goToStep(4);
    document.getElementById('btn-submit').onclick = () => goToStep(5);


    // --- èŠ±è—å¯¦é©—å®¤åŠŸèƒ½ (Drag & Drop ç°¡åŒ–ç‰ˆ) ---
    const canvas = document.getElementById('flower-canvas');

    function addFlower(emoji) {
        const el = document.createElement('div');
        el.className = 'draggable-item';
        el.innerText = emoji;
        
        // éš¨æ©Ÿä½ç½®æ”¾ç½®
        el.style.left = (Math.random() * 80 + 10) + '%';
        el.style.top = (Math.random() * 80 + 10) + '%';
        
        // ç°¡å–®æ‹–æ›³é‚è¼¯
        let isDragging = false;
        
        el.addEventListener('mousedown', (e) => {
            isDragging = true;
            el.style.zIndex = 1000; // æ‹‰åˆ°æœ€ä¸Šå±¤
        });
        
        document.addEventListener('mousemove', (e) => {
            if (isDragging) {
                const rect = canvas.getBoundingClientRect();
                el.style.left = (e.clientX - rect.left - 20) + 'px'; // 20æ˜¯ä¿®æ­£ä¸­å¿ƒé»
                el.style.top = (e.clientY - rect.top - 20) + 'px';
            }
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            el.style.zIndex = '';
        });

        // æ‰‹æ©Ÿè§¸æ§æ”¯æ´ (ç°¡åŒ–ç‰ˆ)
        el.addEventListener('touchstart', (e) => { isDragging = true; });
        el.addEventListener('touchmove', (e) => {
            if (isDragging) {
                e.preventDefault(); // é˜²æ­¢æ»¾å‹•é é¢
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                el.style.left = (touch.clientX - rect.left - 20) + 'px';
                el.style.top = (touch.clientY - rect.top - 20) + 'px';
            }
        });
        el.addEventListener('touchend', () => { isDragging = false; });

        canvas.appendChild(el);
    }

    function clearCanvas() {
        canvas.innerHTML = '<span style="position:absolute; top:40%; left:35%; color:#ccc; pointer-events:none;">åœ¨é€™è£¡å‰µä½œ</span>';
    }

</script>

</body>
</html>